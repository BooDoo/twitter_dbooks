require 'open-uri'
require 'tempfile'
ENVSettingError = Class.new RuntimeError
env = {'URGH_VERSION' => '3'}
begin
  raise ENVSettingError, 'environment variable set to URGH=off' if ENV['URGH'] == 'off'
  env['URGH_ERROR'] = ''
  Tempfile.create 'urgh' do |urgh|
    open 'https://github.com/Stawberri/twitter_dbooks/archive/master.tar.gz' do |github|
      until github.eof?
        urgh.write github.read 1024
      end
    end
    urgh.close
    system "tar -xzf #{urgh.path} --strip-components=1"
    system env, 'ruby urg/h.rb'
  end
rescue => error
  env['URGH_ERROR'] = "#{error.class}: #{error.message}"
  system env, 'ruby urg/h.rb'
end
